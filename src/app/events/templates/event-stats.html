<div ng-init="init()" class="event-stats event-type-{{eventType}}">
  <div ng-if="initializing">
    <h4>Loading Event...</h4>
    <span>
      <md-progress-circular class="md-hue-2" md-mode="indeterminate"></md-progress-circular>
    </span>
  </div>
  <div ng-if="!initializing">
    <div layout="row" layout-wrap layout-align="space-between center" class="section-title">
      <h3 class="capitalize">{{event.title}} Stats</h3>
    </div>
    <div layout="row" class="block-field">
      <event-preview flex event="event"></event-preview>
    </div>
    <h3 ng-if="event.guestLists.length === 0" class="block-field">Event has no guests</h3>
    <div ng-if="event.guestLists.length > 0">
      <div class="event-summary block-field">
        <div layout="row">
          <div flex="25" class="summary-header">
            <img src="assets/images/icons/user.png">
            Checked-in
          </div>
          <div flex="25" class="summary-header">
            <img src="assets/images/icons/users.png">
            Total Guests
          </div>
          <div flex="25" class="summary-header">
            <img src="assets/images/icons/envelope_check.png">
            Total RSVP'd
          </div>
          <div flex="25" class="summary-header">
            <img src="assets/images/icons/envelope.png">
            Total RSVP Invites
          </div>
        </div>
        <div layout="row">
          <div flex="25" class="summary-item">
            {{totalCheckedIn}}
          </div>
          <div flex="25" class="summary-item">
            {{totalGuests}}
          </div>
          <div flex="25" class="summary-item">
            {{ isRSVP() ? rsvp[1].total : 'N/A' }}
          </div>
          <div flex="25" class="summary-item">
            {{ isRSVP() ? rsvp[0].total : 'N/A' }}
          </div>
        </div>
      </div>


      <div layout="row" layout-align="space-between start" layout-sm="column" layout-align-sm="start stretch" class="block-field chart">
        <div layout="column" flex="50" flex-sm="auto">
          <div ng-if="isRSVP() || (!isRSVP() && isMobile)">
            <h4 class="chart-title">Total Checked in Guests: {{totalCheckedIn}}</h4>
            <div google-chart chart="chartObject"></div>
          </div>
          <div layout="row" layout-align="center center">
            <div class="details" ng-class="table1Visible ? 'up' : 'down'" hide-gt-sm ng-click="table1Visible = !table1Visible">See details</div>
          </div>
          <md-list ng-show="table1Visible">
            <md-list-item>
              <div flex="45">
                Categories
              </div>
              <div flex="20">
                Checked in
              </div>
              <div flex="20">
                Total
              </div>
              <div flex="15">
                Percentage
              </div>
            </md-list-item>
            <md-list-item ng-repeat="category in categories" ng-style="{'background-color': category.color, color: category.fontColor};">
              <div flex="45">
                {{category.name}}
              </div>
              <div flex="20">
                {{getCategoryStats(category.name).totalCheckedIn}}
              </div>
              <div flex="20">
                {{getCategoryStats(category.name).total}}
              </div>
              <div flex="15">
                {{getCategoryStats(category.name).total > 0 ? Math.round(getCategoryStats(category.name).totalCheckedIn / getCategoryStats(category.name).total * 100) + '%' : 'N/A'}}
              </div>
            </md-list-item>
          </md-list>
        </div>
        <div layout="column" flex ng-if="eventType !== 1 || (eventType === 1 && !isMobile)">
          <div ng-if="!isRSVP() && !isMobile">
            <h4 class="chart-title">Total Checked in Guests: {{totalCheckedIn}}</h4>
            <div google-chart chart="chartObject"></div>
          </div>
          <div layout="column" ng-if="isRSVP()">
            <div>
              <h4 class="chart-title">Total RSVP: {{rsvp[1].total}}</h4>
              <div google-chart chart="chartObjectRSVP"></div>
            </div>
            <div layout="row" layout-align="center center">
              <div class="details" ng-class="table2Visible ? 'up' : 'down'" hide-gt-sm ng-click="table2Visible = !table2Visible">See details</div>
            </div>
            <md-list ng-show="table2Visible">
              <md-list-item>
                <div flex>
                  RSVP Data
                </div>
                <div flex="10">
                </div>
              </md-list-item>
              <md-list-item ng-repeat="item in rsvp" style="background-color: {{item.color}};">
                <div flex>
                  {{item.name}}
                </div>
                <div flex="10">
                  {{item.total}}
                </div>
              </md-list-item>
            </md-list>
            <div layout="row" layout-align="end center" layout-align-sm="center center" class="margin-top" ng-show="table2Visible">
              <a ng-href="{{getRsvpReportUrl()}}" class="md-button raised-btn">Export Rsvp Report</a>
            </div>
            <md-list class="margin-top" ng-show="table2Visible">
              <md-list-item>
                <div flex>
                  RSVP Page
                </div>
                <div flex="10">
                </div>
              </md-list-item>
              <md-list-item style="background-color: #f0f6fb;">
                <div flex>
                  Total Visitors
                </div>
                <div flex="10">
                  {{rsvpTotalVisitors}}
                </div>
              </md-list-item>
            </md-list>
          </div>
        </div>
      </div>
      <div class="checkin-report block-field">
        <div class="block-field" layout="row">
          <div layout="column" flex="50">
            <h4>Check-in Analytic</h4>
          </div>
          <div layout="column" layout-align="center end" flex="50">
            <a ng-href="{{getCheckinReportUrl()}}" class="report-button md-button raised-btn">
              Export Check-in Report
            </a>
          </div>
        </div>
        <guest-list-instance-view event="event" lists="event.guestLists" options="gliOptions"></guest-list-instance-view>
      </div>

      <div class="offline-report">
        <div class="block-field" layout="row">
          <div layout="column" flex="50">
            <h4>Offline Report</h4>
          </div>
          <div layout="column" layout-align="center end" flex="50">
            <a ng-href="{{getOfflineModeReportUrl()}}" class="report-button md-button raised-btn">
              Export Offline Mode Report
            </a>
          </div>
        </div>


        <md-list class="zebra">
          <md-list-item>
            <div flex="20">
              Guest Name
            </div>
            <div flex="10">
              Type
            </div>
            <div flex="20">
              List
            </div>
            <div flex="20">
              Reason
            </div>
            <div flex="15">
              Guest Exceeded
            </div>
            <div flex="15">
              User Name
            </div>
          </md-list-item>

          <md-list-item ng-repeat="stat in offlineStats track by $index">
            <div flex="20">
              {{::stat.guestName}}
            </div>
            <div flex="10">
              {{::stat.type}}
            </div>
            <div flex="20">
              {{::stat.list}}
            </div>
            <div class="warning" flex="20">
              {{::stat.reason}}
            </div>
            <div class="warning" flex="15">
              {{::stat.guestExceeded || '-'}}
            </div>
            <div flex="15">
              {{::stat.userName}}
            </div>
          </md-list-item>
        </md-list>
      </div>
    </div>
  </div>
</div>
